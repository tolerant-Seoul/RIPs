---
rip: 7767
title: Gas to Ether 컨트랙트
description: 가스를 소각하고 소각된 가스의 일부를 호출자에게 이더로 반환하는 컨트랙트
author: Vectorized (@Vectorized), Mark Tyneway (@tynes), Zak Cole (@zscole), Charles Cooper (@charles-cooper)
discussions-to: https://ethereum-magicians.org/t/rip-7767-gas-to-ether-precompile/21005
status: Draft
type: Standards Track
category: Core
created: 2024-09-12
---

## 개요

이 제안은 호출자가 특정 양의 가스를 소각하고, 소각된 가스의 일부를 호출자에게 이더로 반환하는 컨트랙트를 설명합니다.

## 동기

컨트랙트 보안 수익(CSR, Contract Secured Revenue)은 컨트랙트 개발자가 자신의 컨트랙트에서 가스 수수료를 벌 수 있게 합니다.

이는 구성 가능하고, 상호 운용 가능하며, 강제 가능한 방식으로 새로운 수익 흐름을 가능하게 합니다. CSR은 기존 토큰 표준 및 애플리케이션과 함께 작동합니다. 개발자가 가치를 포착하기 위해 새로운 컨트랙트 표준을 깨거나 만들 필요가 없습니다.

그러나 모든 옵코드에서 소비된 가스로 측정되는 암묵적 CSR은 부정적인 외부효과를 초래할 수 있습니다. 개발자는 불필요한 스토리지 쓰기 및 계산을 수행하는 루프를 사용하는 것과 같이 부풀린 컨트랙트를 작성하도록 인센티브를 받습니다.

이 표준은 소각된 가스를 일정한 비용으로 이더로 변환하는 특수 컨트랙트인 `GASBACK`으로 CSR을 명시적으로 만들 것을 제안합니다. 개발자는 `GASBACK`에 사용할 더 많은 가스 여유를 가질 수 있도록 효율적인 컨트랙트를 작성하도록 인센티브를 받습니다.

`GASBACK`은 다음과 같은 장점을 제공합니다:
- 구성 가능성, 이더가 호출자에게 즉시 지불되기 때문입니다. 또한 `GASBACK`은 명시적 CSR을 위한 표준화된 인터페이스를 제공하여 도구 및 애플리케이션에서 재사용 가능한 통합 코드를 가능하게 합니다.
- 무허가성, `GASBACK`을 통합하는 컨트랙트는 의도적으로 부풀린 코드를 작성하지 않는지 확인하기 위해 중앙화된 팀의 검증을 받을 필요가 없기 때문입니다.
- 투명성, `GASBACK`은 검증된 코드로 Solidity에서 구현될 수 있기 때문입니다. 이는 개발자에게 불투명한 CRON 작업으로 운영되는 전통적인 암묵적 CSR보다 더 나은 명확성과 확신을 제공합니다.
- 유지보수성, `GASBACK`이 단순하고 유연하기 때문입니다.
- 사용성, `GASBACK`에서 소각된 가스가 일반 가스와 쉽게 구분될 수 있기 때문입니다.

## 사양

이 컨트랙트를 `GASBACK` 컨트랙트라고 합니다.

### 동작

`GASBACK` 컨트랙트는 콜데이터로 `bytes32(uint256(gasToBurn))`을 받습니다.

실제로 소각되는 가스 양은 다를 수 있지만 `gasToBurn`에 비례해야 합니다(SHOULD).

`GASBACK` 컨트랙트는 `gasToBurn`에 대해 상태 및 계산 비용이 `O(1)`이어야 합니다(MUST).

`GASBACK` 컨트랙트는 호출자에게 소각된 가스의 일부를 이더(또는 네이티브 통화)로 돌려줘야 합니다(SHOULD).

`GASBACK` 컨트랙트는 호출자에게 이더를 최선의 노력으로 전송해야 합니다(SHOULD). `call`로 이더 전송이 실패하면 `GASBACK` 컨트랙트는 `SELFDESTRUCT` 옵코드를 사용하여 이더를 강제 전송하는 새 컨트랙트를 생성할 수 있습니다(MAY).

`GASBACK` 컨트랙트는 `bytes32(uint256(amountOfEtherGivenBackToCaller))`를 반환해야 합니다(MUST).

소각된 가스에서 얻은 이더의 양은 `basefee * actualGasBurned`를 초과해서는 안 됩니다(MUST NOT).

`GASBACK`에서 소각된 가스는 [EIP-1559](https://eips.ethereum.org/EIPS/eip-1559) 및 블록 가스 한도에서 제외될 수 있습니다(MAY).

`GASBACK`은 전통적인 암묵적 CSR과 공존할 수 있지만, 최대 이점을 위해 체인이 가능하면 `GASBACK`으로 완전히 마이그레이션하는 것이 권장됩니다(RECOMMENDED).

### 비콘

다양한 L2 구현을 지원하기 위해 `GASBACK` 컨트랙트에 대해 지정된 주소가 없습니다.

`GASBACK`을 구현하는 체인은 문서에 해당 주소를 포함해야 합니다(SHOULD).

온체인 검색을 용이하게 하기 위해 Nick의 `CREATE2` 팩토리에 의해 배포된 정규 비콘 컨트랙트를 지정합니다. 이 비콘 컨트랙트는 호출될 때 `abi.encode(gasbackAddress)`를 반환합니다.

```solidity
// SPDX-License-Identifier: CC0-1.0
pragma solidity ^0.8.28;

// solc = 0.8.28, evm = london, optimization = 1000.
contract GasbackBeacon {
    fallback() external payable {
        assembly {
            mstore(0x40, sload(returndatasize()))
            if xor(caller(), 0xffffFFFfFFffffffffffffffFfFFFfffFFFfFFfE) { return(0x40, 0x20) }
            sstore(returndatasize(), calldataload(returndatasize()))
        }
    }
}
```

비콘 컨트랙트의 최종 주소는 TBD입니다.

일부 체인은 `CREATE2` 배포를 지원하지 않으므로 `GASBACK` 비콘 컨트랙트 구현은 선택 사항입니다(OPTIONAL).

## 근거

`GASBACK`은 사전 설치, 사전 배포, 프리컴파일로 구현될 수 있습니다.

Optimism 스택에서는 클라이언트를 수정하지 않고 사전 배포로 `GASBACK`을 구현할 수 있습니다.

동작은 각 EVM 체인에 가장 적합한 방식으로 `GASBACK`을 구현할 수 있도록 의도적으로 단순하고 유연하게 유지됩니다.

## 보안 고려사항

구현자는 프리컴파일이 네트워크의 총 이더 양의 순 증가를 초래하지 않도록 해야 합니다.

소각된 가스 메트릭을 기반으로 소급 자금 지원을 호스팅하는 EVM 체인은 `GASBACK` 프리컴파일을 통해 소각된 총 가스 양을 빼야 합니다.

## 저작권

저작권 및 관련 권리는 [CC0](../LICENSE.md)를 통해 포기되었습니다.
