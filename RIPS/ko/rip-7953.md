---
rip: 7953
title: 네이티브 계정 추상화를 위한 시스템 이벤트
description: 트랜잭션 데이터 액세스를 단순화하기 위해 네이티브 계정 추상화 트랜잭션에 대해 자동으로 발생하는 이벤트
author: Yoav Weiss (@yoavw), Alex Forshtat (@forshtat), Dror Tirosh (@drortirosh), Shahaf Nacson (@shahafn)
discussions-to:
status: Draft
type: Standards Track
category: Core
created: 2025-04-01
requires: 7560
---

## 개요

이 제안은 RIP-7560 트랜잭션을 실행하는 동안 `LOG` 옵코드 호출 없이 가상 머신에 의해 직접 주입되는 시스템 이벤트를 설명합니다.

## 동기

[ERC-4337](https://eips.ethereum.org/EIPS/eip-4337)은 `UserOperation`이라는 구조체 배열을 받아 계정 추상화 프로토콜의 일부로 실행하는 `EntryPoint` 컨트랙트를 정의합니다.

`EntryPoint` 컨트랙트는 `UserOperation` 실행 중에 그렇지 않으면 사용할 수 없는 온체인 상태의 일부 세부 정보를 노출하기 위해 이벤트를 발생시킵니다.

또한, 이더리움 이벤트용 API는 이벤트 구독이나 인덱싱된 매개변수와 같은 고유하고 유용한 기능을 지원합니다.

이더리움 L1에도 유사한 제안 세트가 존재하며, 특히 [EIP-7708](https://eips.ethereum.org/EIPS/eip-7708) 및 [EIP-7889](https://eips.ethereum.org/EIPS/eip-7889)가 있습니다.

## 사양

### 시스템 트랜잭션 이벤트

RIP-7560 트랜잭션의 일부로 발생하는 다음 시스템 수준 이벤트를 정의합니다:

```solidity
    event RIP7560TransactionEvent(
        address indexed sender,
        address indexed paymaster,
        address indexed deployer,
        uint256 nonce,
        uint256 executionStatus
    );

    event RIP7560TransactionRevertReason(
        address indexed sender,
        uint256 nonce,
        bytes revertReason
    );

    event RIP7560TransactionPostOpRevertReason(
        address indexed sender,
        address indexed paymaster,
        uint256 nonce,
        bytes revertReason
    );
```

* `RIP7560TransactionEvent` 이벤트는 각 RIP-7560 트랜잭션의 끝에서 발생합니다.

* `RIP7560TransactionRevertReason` 이벤트는 RIP-7560 트랜잭션의 실행 프레임이 0이 아닌 길이의 반환 데이터로 되돌려진 경우 발생합니다.

* `RIP7560TransactionPostOpRevertReason` 이벤트는 RIP-7560 트랜잭션 Paymaster의 "postOp" 호출이 0이 아닌 길이의 반환 데이터로 되돌려진 경우 발생합니다.

`revertReason` 매개변수로 반환되는 바이트 배열은 최대 길이인 `MAX_REVERT_REASON_SIZE`로 잘립니다.
해당 길이 이상으로 반환된 모든 데이터는 트랜잭션 영수증에서 관찰되지 않습니다.

시스템 트랜잭션 이벤트의 가스 비용은 별도로 청구되지 않으며 트랜잭션의 `AA_BASE_GAS_COST`에 의해 충당됩니다.

`executionStatus` 값은 다음과 같습니다:

* `success` = 0
* `executionFailure` = 1
* `postOpFailure` = 2
* `executionAndPostOpFailure` = 3

모든 이벤트는 `AA_ENTRY_POINT` 주소에서 발생합니다.

## 근거

### 트랜잭션 영수증을 사용하지 않는 이유

시스템 이벤트의 일부로 노출되는 일부 데이터는 트랜잭션 영수증의 일부로도 노출될 수 있습니다.

이 데이터를 시스템 이벤트로 노출하는 몇 가지 이유가 있습니다:

* 기존 계정 추상화 도구와의 ERC-4337 하위 호환성

지금까지 계정 추상화를 둘러싼 전체 기술 스택이 ERC-4337 프로토콜을 중심으로 발전했기 때문에, 이벤트 기반 접근 방식을 포기하면 일부 기존 도구가 실행 불가능해질 수 있습니다.
이러한 기능 손실은 불필요하며 쉽게 피할 수 있습니다.

* 이벤트는 트랜잭션 영수증에는 존재하지 않는 검색, 필터링 및 구독 API를 제공합니다.

예를 들어, 시스템 이벤트를 사용하면 특정 `Account` 또는 `Paymaster`를 사용하는 모든 트랜잭션을 검색할 수 있습니다.
이 기능은 ERC-7562 멤풀과 같은 평판 기반 시스템에 중요할 수 있습니다.

* 트랜잭션 영수증 수정은 발생된 이벤트보다 더 많은 문제를 야기할 수 있습니다.

계정 추상화 분야가 계속 발전함에 따라, 향후 추가 시스템 이벤트를 정의하는 RIP가 있을 수 있습니다.
또한 시스템 이벤트가 계정 추상화 이외의 작업을 위해 L2에서 채택될 가능성도 있습니다.
이러한 각 제안이 트랜잭션 영수증 스키마에 수정을 도입해야 한다면,
관리하기 어려운 복잡성이 초래될 것입니다.

## 하위 호환성

이 제안은 RIP-7560과 ERC-4337 간의 특정 형태의 하위 호환성을 도입하기 위한 것입니다.

그러나 이벤트 서명은 동일하지 않으며 사용자는 이러한 시스템 이벤트에 대한 지원을 명시적으로 추가해야 합니다.

## 보안 고려사항

시스템 이벤트는 실행 환경에 의해 직접 생성되므로,
이러한 이벤트에 의해 노출된 데이터를 수락하는 데 추가적인 위험이 없습니다.

## 저작권

저작권 및 관련 권리는 [CC0](../LICENSE.md)를 통해 포기되었습니다.
